<?php

function gcd_two_numbers($x, $y) {
	$x = abs($x);
	$y = abs($y);
	while ($y) {
		$t = $y;
		$y = $x % $y;
		$x = $t;
	}
	return $x;
}

function getAngle($x1, $y1, $x2, $y2) {
	$angleRadians = (atan2($y1 - $y2, $x1 - $x2) * 180) / pi();
	if ($angleRadians < 0) $angleRadians += 360;
	$angleRadians -= 90;
	if ($angleRadians < 0) $angleRadians += 360;
	return $angleRadians;
}

function checkLineOfSight($x1, $y1, $x2, $y2, $map) {
	if ($map[$y2][$x2] !== "#") return false;
	if ($map[$y1][$x1] !== "#") return false;
	if ($y2 === $y1 && $x2 === $x1) return false;
	$dy = $y2 - $y1;
	$dx = $x2 - $x1;
	if ($dx === $dy && $dy === 0) {
	} else {
		$gcd = gcd_two_numbers($dy, $dx);
		$dy /= $gcd;
		$dx /= $gcd;
	}
	$x = $x1 + $dx;
	$y = $y1 + $dy;
	$ibtcount = 0;
	while ($map[$y] && $map[$y][$x]) {
		if ($map[$y][$x] === "#") {
			if ($y === $y2 && $x === $x2) {
				return $ibtcount;
			}
			$ibtcount++;
			return false;
		}
		$y += $dy;
		$x += $dx;
	}
}

$field = [
	'.#......#...#.....#..#......#..##..#',
	'..#.......#..........#..##.##.......',
	'##......#.#..#..#..##...#.##.###....',
	'..#........#...........#.......##...',
	'.##.....#.......#........#..#.#.....',
	'.#...#...#.....#.##.......#...#....#',
	'#...#..##....#....#......#..........',
	'....#......#.#.....#..#...#......#..',
	'......###.......#..........#.##.#...',
	'#......#..#.....#..#......#..#..####',
	'.##...##......##..#####.......##....',
	'.....#...#.........#........#....#..',
	'....##.....#...#........#.##..#....#',
	'....#........#.###.#........#...#..#',
	'....#..#.#.##....#.........#.....#.#',
	'##....###....##..#..#........#......',
	'.....#.#.........#.......#....#....#',
	'.###.....#....#.#......#...##.##....',
	'...##...##....##.........#...#......',
	'.....#....##....#..#.#.#...##.#...#.',
	'#...#.#.#.#..##.#...#..#..#..#......',
	'......#...#...#.#.....#.#.....#.####',
	'..........#..................#.#.##.',
	'....#....#....#...#..#....#.....#...',
	'.#####..####........#...............',
	'#....#.#..#..#....##......#...#.....',
	'...####....#..#......#.#...##.....#.',
	'..##....#.###.##.#.##.#.....#......#',
	'....#.####...#......###.....##......',
	'.#.....#....#......#..#..#.#..#.....',
	'..#.......#...#........#.##...#.....',
	'#.....####.#..........#.#.......#...',
	'..##..#..#.....#.#.........#..#.#.##',
	'.........#..........##.#.##.......##',
	'#..#.....#....#....#.#.......####..#',
	'..............#.#...........##.#.#..',
];
$map = [];
foreach($field as $row) {
	$map[] = str_split($row);
}
$resultMap = $map;

$x = 23;
$y = 19;	

$trajectories = [];
for ($y2 = 0; $y2 < count($map); $y2++) {
	for ($x2 = 0; $x2 < count($map[0]); $x2++) {
		$los = checkLineOfSight($x, $y, $x2, $y2, $map);
		if ($los === false) continue;
		$trajectories[] = [
			getAngle($x, $y, $x2, $y2),
			$los, 
			$x2, 
			$y2,
		];
	}
}
usort($trajectories, function($a, $b) {
	return $a <=> $b;
});
echo $trajectories[199][2]*100 + $trajectories[199][3], PHP_EOL;
